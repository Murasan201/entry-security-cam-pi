# 要件定義書：玄関セキュリティシステム（Python入門書用アプリ）

**Repository Name:** `entry-security-cam-pi`

**Description:** A beginner-friendly Python app for Raspberry Pi that detects people at your doorstep using a USB camera and YOLO, and saves video clips to a USB drive.


## 1. 概要
Raspberry PiとUSBカメラを用いて、玄関を常時監視するセキュリティシステムを構築する。本アプリはYOLOを活用し、人間を検出したタイミングで録画をトリガーとし、検出前後の映像を含めた動画を外部ストレージへ保存する。Pythonの初学者向け入門書の題材として、実用性と学習効果を両立する構成とする。

---

## 2. 目的
- Pythonの基本的な文法・構文の習得
- Raspberry Piを用いたIoTプログラミングの体験
- 画像処理（YOLO）を用いた実践的アプリ開発
- ファイルI/O、マルチスレッド処理、時間制御の学習

---

## 3. システム構成
- **AIフレームワーク**
  - TensorFlow：YOLOモデルの推論処理に使用。事前に環境構築を行うこと。
- **ハードウェア**
  - Raspberry Pi 4 または 5
  - USBカメラ（UVC対応）
  - 外部ストレージ（USBメモリに限定）

- **ソフトウェア**
  - Python 3.x
  - OpenCV（カメラ映像取得・録画）
  - YOLOv5（人検出）
  - threading, datetime, osモジュール

---

## 4. 機能要件

### 4.1 常時カメラ映像の取得
- USBカメラよりリアルタイム映像を取得
- 画像サイズは640x480程度に調整

### 4.2 人物の検出
- YOLOモデルにより人物（person）の検出を実行
- 検出間隔は0.5秒〜1秒程度とする

### 4.3 録画トリガーとバッファリング
- 検出があった場合、検出前数秒（例：5秒）と検出終了後数秒（例：5秒）の映像を含めた動画ファイルを保存
- 過去映像の一時保存用バッファリング機構を構築（メモリまたは一時ディスク）

### 4.4 録画データの保存
- 動画はMP4形式で保存
- ファイル名に日付と時刻を含める（例：2025-07-28_15-00-05.mp4）
- 保存先はUSBメモリ（/media/pi/USB_DRIVE 等）
- 保存失敗時はエラーログを記録

### 4.5 ステータス表示（オプション）
- 実行中のステータスをターミナルに表示
  - 例：「映像監視中」「人物検出：録画中」「保存完了」など

---

## 5. 非機能要件
- 初学者でも扱いやすいソースコード構造（関数単位で整理）
- コメントを適切に挿入し、学習教材としての可読性を確保
- モジュール分割は最小限、1ファイルまたは2ファイル程度で完結
- 外部ライブラリのインストール方法も記載（pip使用）

---

## 6. 制約事項
- YOLOの推論はRaspberry Pi上で動作可能な軽量モデルを使用（例：YOLOv5n）
- リアルタイム検出精度には限界あり、過検出・未検出の可能性を許容
- USBメモリは事前に接続されていることが前提

---

## 7. 拡張案（書籍後半で紹介予定）
- GUIによる映像表示と録画状況の視覚化
- Slack通知連携によるアラート送信
- ローカルWebサーバによる録画映像の閲覧機能（Flask使用）

---

## 8. ファイル構成（予定）
```
entry_security/
├── main.py                 # メインスクリプト
├── models/
│   └── yolov5n.pt          # 学習済みモデル（ダウンロードリンク案内）
├── recordings/             # 録画ファイル保存先（USBメモリ）
└── README.md               # 実行方法・環境構築手順
```

---

## 9. 実行手順（概要）
1. 必要ライブラリのインストール（pip）
2. YOLOモデルファイルのダウンロード
3. USBメモリをマウント
4. `main.py` を実行
5. 人物が検出されると自動で録画・保存

---

## 10. 学習ポイント
- Raspberry PiとPythonを用いたリアルタイム処理
- 画像処理ライブラリ（OpenCV）の活用
- AIモデルの活用（YOLOによる推論）
- バッファリングとマルチスレッド処理の実装
- ファイル保存とログ管理

---

## 11. 事前準備：USBメモリのフォーマット
本アプリでは録画データをUSBメモリに保存するため、USBメモリを以下の手順で事前にフォーマットすることを推奨する。

### 推奨フォーマット形式
- **FAT32**：互換性が高く、Raspberry Pi OSでも標準でサポートされている。
- **exFAT**：4GB以上のファイルを扱いたい場合に有効。Raspberry Pi OSでは`exfat-fuse`と`exfat-utils`のインストールが必要。

### フォーマット方法（Windowsの場合）
1. USBメモリをPCに接続
2. [SDメモリカードフォーマッター（SDFormatter）](https://www.sdcard.org/jp/downloads/formatter/)をダウンロードしてインストール
3. SDFormatterを起動し、対象のUSBメモリを選択
4. 「クイックフォーマット」を選び、「フォーマット」をクリック
5. フォーマットが完了したら、USBメモリを取り出してRaspberry Piに接続

※ 重要なデータが入っている場合は必ずバックアップを取ってから実行すること。

---

## 12. 備考
本アプリはPython入門者にとって「セキュリティ × AI × IoT」を体感できる実践教材として設計しており、動作はシンプルながらも技術的な広がりを持たせている。
